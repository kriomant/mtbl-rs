<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `mtbl` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, mtbl">

    <title>mtbl - Rust</title>

    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'></p><script>window.sidebarCurrent = {name: 'mtbl', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Crate <a class='mod' href=''>mtbl</a></span><span class='out-of-band'><span id='render-detail'>
            <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                [<span class='inner'>&#x2212;</span>]
            </a>
        </span><a id='src-0' class='srclink' href='../src/mtbl/src/lib.rs.html#1-122' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Rust bindings to the <a href="https://github.com/farsightsec/mtbl">mtbl</a> library for
dealing with SSTables (immutable sorted map files).</p>

<p>SSTables (String-String Tables) are basically constant on-disk maps from
[u8] to [u8], like those used by
<a href="http://www.corpit.ru/mjt/tinycdb.html">CDB</a> (which also has <a href="https://github.com/andrew-d/tinycdb-rs">Rust
bindings</a>), except using sorted maps
instead of hashmaps. SSTables are suitable for storing the output of
mapreduces or other batch results for easy lookup later.</p>

<p>Version 0.1.0 of this library is a rather literal translation of the mtbl C
API. Later versions may change the API to be friendlier and more in the
Rust idioms.</p>

<h1 id='usage' class='section-header'><a href='#usage'>Usage</a></h1>
<h2 id='creating-a-database' class='section-header'><a href='#creating-a-database'>Creating a database</a></h2>
<pre class='rust rust-example-rendered'>
<span class='comment'>// Create a database, using a Sorter instead of a Writer so we can add</span>
<span class='comment'>// keys in arbitrary (non-sorted) order.</span>
{
  <span class='kw'>use</span> <span class='ident'>mtbl</span>::{<span class='ident'>Sorter</span>,<span class='ident'>Write</span>};
  <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>writer</span> <span class='op'>=</span> <span class='ident'>mtbl</span>::<span class='ident'>Sorter</span>::<span class='ident'>create</span>(<span class='string'>&quot;data.mtbl&quot;</span>);
  <span class='ident'>writer</span>.<span class='ident'>add</span>(<span class='string'>&quot;key&quot;</span>, <span class='string'>&quot;value&quot;</span>);
  <span class='comment'>// Data is flushed to file when the writer/sorter is destroyed.</span>
}</pre>

<h2 id='reading-from-a-database' class='section-header'><a href='#reading-from-a-database'>Reading from a database</a></h2>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>mtbl</span>::{<span class='ident'>Read</span>,<span class='ident'>Reader</span>};
<span class='kw'>let</span> <span class='ident'>reader</span> <span class='op'>=</span> <span class='ident'>mtbl</span>::<span class='ident'>Reader</span>::<span class='ident'>open</span>(<span class='string'>&quot;data.mtbl&quot;</span>);
<span class='comment'>// Get one element</span>
<span class='kw'>let</span> <span class='ident'>val</span>: <span class='prelude-ty'>Option</span>(<span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span>) <span class='op'>=</span> <span class='ident'>reader</span>.<span class='ident'>get</span>(<span class='string'>&quot;key&quot;</span>);
<span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>val</span>, <span class='prelude-ty'>Option</span>(<span class='string'>&quot;value&quot;</span>.<span class='ident'>as_bytes</span>()));
<span class='comment'>// Or iterate over all entries</span>
<span class='kw'>for</span> (<span class='ident'>key</span>: <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span>, <span class='ident'>value</span>: <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span>) <span class='kw'>in</span> <span class='kw-2'>&amp;</span><span class='ident'>reader</span> {
    <span class='ident'>f</span>(<span class='ident'>key</span>, <span class='ident'>value</span>);
}</pre>

<h1 id='more-details-about-mtbl' class='section-header'><a href='#more-details-about-mtbl'>More details about MTBL</a></h1>
<p>Quoting from the MTBL documentation:</p>

<blockquote>
<p>mtbl is not a database library. It does not provide an updateable
key-value data store, but rather exposes primitives for creating,
searching and merging SSTable files. Unlike databases which use the
SSTable data structure internally as part of their data store, management
of SSTable files -- creation, merging, deletion, combining of search
results from multiple SSTables -- is left to the discretion of the mtbl
library user.</p>

<p>mtbl SSTable files consist of a sequence of data blocks containing sorted
key-value pairs, where keys and values are arbitrary byte arrays. Data
blocks are optionally compressed using zlib or the Snappy library. The
data blocks are followed by an index block, allowing for fast searches
over the keyspace.</p>

<p>The basic mtbl interface is the writer, which receives a sequence of
key-value pairs in sorted order with no duplicate keys, and writes them
to data blocks in the SSTable output file. An index containing offsets to
data blocks and the last key in each data block is buffered in memory
until the writer object is closed, at which point the index is written to
the end of the SSTable file. This allows SSTable files to be written in a
single pass with sequential I/O operations only.</p>

<p>Once written, SSTable files can be searched using the mtbl reader
interface. Searches can retrieve key-value pairs based on an exact key
match, a key prefix match, or a key range. Results are retrieved using a
simple iterator interface.</p>

<p>The mtbl library also provides two utility interfaces which facilitate a
sort-and-merge workflow for bulk data loading. The sorter interface
receives arbitrarily ordered key-value pairs and provides them in sorted
order, buffering to disk as needed. The merger interface reads from
multiple SSTables simultaneously and provides the key-value pairs from
the combined inputs in sorted order. Since mtbl does not allow duplicate
keys in an SSTable file, both the sorter and merger interfaces require a
caller-provided merge function which will be called to merge multiple
values for the same key. These interfaces also make use of sequential I/O
operations only.</p>
</blockquote>

<h1 id='why-prefer-mtbl-over-cdb-or-other-constant-databases' class='section-header'><a href='#why-prefer-mtbl-over-cdb-or-other-constant-databases'>Why prefer MTBL over CDB or other constant databases?</a></h1>
<ul>
<li>Storing data in sorted order makes merging files easy.</li>
<li>Compression is built-in (options: <a href="http://www.zlib.net/">zlib</a> and
<a href="https://github.com/google/snappy">snappy</a>).</li>
<li>The library code is a little more modern and uses mmapped files to have
a properly immutable (and therefore thread-safe) representation -- it
doesn&#39;t go mucking about with file pointers.</li>
</ul>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.Fileset.html'
                               title='mtbl::Fileset'>Fileset</a></td>
                        <td class='docblock short'>
                             <p>An MTBL reader that watches a &quot;setfile&quot; containing a list of MTBL files to
read from.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.FilesetOptions.html'
                               title='mtbl::FilesetOptions'>FilesetOptions</a></td>
                        <td class='docblock short'>
                             <p>Options for opening an MTBL fileset.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.Merger.html'
                               title='mtbl::Merger'>Merger</a></td>
                        <td class='docblock short'>
                             <p>An MTBL reader that opens and reads from several MTBL files, merging their
contents.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.Reader.html'
                               title='mtbl::Reader'>Reader</a></td>
                        <td class='docblock short'>
                             <p>A reader for a single MTBL file.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.ReaderOptions.html'
                               title='mtbl::ReaderOptions'>ReaderOptions</a></td>
                        <td class='docblock short'>
                             <p>MTBL Reader opening options.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.Sorter.html'
                               title='mtbl::Sorter'>Sorter</a></td>
                        <td class='docblock short'>
                             <p>A tool to create an MTBL file out of keys in any order.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.SorterOptions.html'
                               title='mtbl::SorterOptions'>SorterOptions</a></td>
                        <td class='docblock short'>
                             <p>Options used to create a <code>Sorter</code>.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.Writer.html'
                               title='mtbl::Writer'>Writer</a></td>
                        <td class='docblock short'>
                             <p>A struct to create an MTBL file from keys and values in sorted order.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.WriterOptions.html'
                               title='mtbl::WriterOptions'>WriterOptions</a></td>
                        <td class='docblock short'>
                             <p>Options for writing an MTBL file.</p>
                        </td>
                    </tr>
                </table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='enum' href='enum.CompressionType.html'
                               title='mtbl::CompressionType'>CompressionType</a></td>
                        <td class='docblock short'>
                             <p>Compression method used when writing an MTBL file.</p>
                        </td>
                    </tr>
                </table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='trait' href='trait.Read.html'
                               title='mtbl::Read'>Read</a></td>
                        <td class='docblock short'>
                             <p>A trait for objects that can read keys from an MTBL file.</p>
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='trait' href='trait.Write.html'
                               title='mtbl::Write'>Write</a></td>
                        <td class='docblock short'>
                             <p>A trait for objects that can write an MTBL file.</p>
                        </td>
                    </tr>
                </table><h2 id='types' class='section-header'><a href="#types">Type Definitions</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='type' href='type.MergeFn.html'
                               title='mtbl::MergeFn'>MergeFn</a></td>
                        <td class='docblock short'>
                             <p>An MTBL merging function: given a key and two values for that key, create a
merged value for that key.</p>
                        </td>
                    </tr>
                </table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "mtbl";
        window.playgroundUrl = "";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    
    <script defer src="../search-index.js"></script>
</body>
</html>